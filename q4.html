<!DOCTYPE html>
<html>

<head>
    <title>Q4</title>

    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec3 position;
        attribute vec3 normal;
        uniform mat4 projection, modelview, normalMat;
        varying vec3 normalInterp;
        varying vec3 vertPos;

        void main()
        {
            vec4 vertPos4 = modelview * vec4(position, 1.0);
            vertPos = vec3(vertPos4) / vertPos4.w;
            normalInterp = vec3(normalMat * vec4(normal, 0.0));
            gl_Position = projection * vertPos4;
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;

        varying vec3 normalInterp; // Surface normal
        varying vec3 vertPos; // Vertex position
        
        uniform vec3 planePos; // Plane position 
        uniform int mode; // Rendering mode
        
        uniform vec3 lightPos; // Light position

        vec3 AmbientC(y) 
        {
            if (y < 0.0) return vec3(0.0, 0.8); // Water
            else if (y < 0.1) return vec3(1.0, 0.8, 0.6); // Beach
            else if (y < 0.2) return vec3(0.0, 0.8, 0.4); // Forest
            else if (y < 0.4) return vec3(0.0, 0.6, 0.0); // Jungle
            else if (y < 0.6) return vec3(0.6, 0.8, 0.0); // Savannah
            else if (y < 0.8) return vec3(0.8, 0.6, 0.0); // Desert
            else return (1.0, 1.0, 1,0); // Snow
        }

        float Shininess(y) 
        {
            if (y < 0.0) return 80.0; // Water
            else if (y < 0.6) return 0.0; // Beach to savannah
            else return 20.0; // Desert to snow
        }

        float Ks(y)
        {
            if (y < 0.0) return 1.0; // Water
            else if (y < 0.6) return 0.0; // Beach to savannah
            else return 0.4; // Desert to snow    
        }        


        void main() 
        {
            float y = vertPos.y;

            // Material Color
            vec3 ambientColor = AmbientC(y);
            vec3 diffuseColor = vec3(1.0, 1.0, 1.0); // White
            vec3 specularColor = vec3(1.0, 1.0, 1.0); // White

            vec3 N = normalize(normalInterp); // Normal vector 
            vec3 L = normalize(lightPos - vertPos); // Vector to light source

            // Lambert's cosine law
            float lambertian = max(dot(N, L), 0.0);
            float specular = 0.0;

            vec3 R = reflect(-L, N); // Reflected light vector
            vec3 V = normalize(planePos -vertPos); // Vector to viewer/plane
            // Compute the specular term
            float specAngle = max(dot(R, V), 0.0);
            specular = pow(specAngle, Shininess(y)); 
        
            if (mode == 1) 
            // Flat - only ambient
            {
                // Ambient reflection coefficient = 1.0
                gl_FragColor = vec4(ambientColor, 1.0);
            }

            else if (mode == 2)
            // Smooth  - ambient and specular
            {
                gl_FragColor = vec4(Ks(y) * lambertian * diffuseColor, 1.0);  
            } 

            else 
            // Phong - all 3 components
            {
                // Diffuse reflection coefficient = 0.2
                gl_FragColor = vec4(0.2 * specular * specularColor, 1.0);
            }
        }

    </script>

    <script type="text/javascript" src="https://www.cs.unm.edu/~angel/BOOK/INTERACTIVE_COMPUTER_GRAPHICS/SEVENTH_EDITION/CODE/Common/webgl-utils.js"></script>
    <script type="text/javascript" src="https://www.cs.unm.edu/~angel/BOOK/INTERACTIVE_COMPUTER_GRAPHICS/SEVENTH_EDITION/CODE/Common/initShaders.js"></script>
    <script type="text/javascript" src="https://www.cs.unm.edu/~angel/BOOK/INTERACTIVE_COMPUTER_GRAPHICS/SEVENTH_EDITION/CODE/Common/MV.js"></script>
    <script type="text/javascript" src="q4.js"></script>
</head>

<body>
    

    <canvas id="gl-canvas" width="512" height="512">
        Your browser does not support HTML5.
    </canvas>
</body>

</html>